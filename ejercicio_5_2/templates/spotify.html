<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de M√∫sica - Spotify</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #191414 100%); min-height: 100vh; color: white; padding-bottom: 100px; }
        header { background: rgba(0,0,0,0.85); padding: 20px; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap; }
        h1 { color: #1DB954; font-size: 2em; display: flex; align-items: center; gap: 10px; }
        .search-container { flex: 1; max-width: 600px; min-width: 300px; }
        .search-box { display: flex; gap: 10px; }
        input[type="text"] { flex: 1; padding: 12px 20px; border: none; border-radius: 25px; background: #282828; color: white; font-size: 16px; }
        input[type="text"]:focus { outline: 2px solid #1DB954; }
        select { padding: 12px 15px; border: none; border-radius: 25px; background: #282828; color: white; cursor: pointer; font-size: 14px; }
        button { padding: 12px 30px; background: #1DB954; color: white; border: none; border-radius: 25px; font-weight: bold; cursor: pointer; transition: transform 0.2s, background 0.3s; }
        button:hover { background: #1ed760; transform: scale(1.05); }
        .container { max-width: 1400px; margin: 0 auto; padding: 30px 20px; }
        .resultados-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .resultado-card { background: rgba(40,40,40,0.85); border-radius: 15px; padding: 15px; cursor: pointer; transition: all 0.3s; }
        .resultado-card:hover { background: rgba(40,40,40,1); transform: translateY(-5px); box-shadow: 0 10px 30px rgba(29,185,84,0.3); }
        .resultado-imagen { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 10px; background: #282828; margin-bottom: 12px; }
        .resultado-nombre { font-weight: bold; margin-bottom: 5px; font-size: 15px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .resultado-info { color: #b3b3b3; font-size: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .resultado-meta { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; padding-top: 10px; border-top: 1px solid #404040; font-size: 13px; }
        .play-button { width: 44px; height: 44px; background: #1DB954; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.2s; margin-top: 10px; font-size: 18px; border: none; }
        .play-button:hover { transform: scale(1.15); background: #1ed760; }
        .loading { text-align: center; padding: 60px 20px; font-size: 18px; color: #b3b3b3; }
        .error { background: rgba(255,0,0,0.15); border: 2px solid #ff4444; padding: 20px; border-radius: 15px; text-align: center; margin: 20px; }
        .stats { display: flex; gap: 8px; font-size: 12px; color: #b3b3b3; flex-wrap: wrap; margin-top: 10px; }
        .stat-badge { background: rgba(29,185,84,0.2); padding: 4px 10px; border-radius: 12px; color: #1DB954; }
        .spotify-link { color: #1DB954; text-decoration: none; font-size: 13px; }
        .spotify-link:hover { text-decoration: underline; }
        /* Player */
        #audioPlayer { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(18,18,18,0.97); padding: 15px 20px; display: none; backdrop-filter: blur(20px); border-top: 1px solid #282828; z-index: 200; }
        .player-inner { max-width: 1400px; margin: 0 auto; display: flex; align-items: center; gap: 15px; }
        #playerImage { width: 55px; height: 55px; border-radius: 8px; object-fit: cover; }
        .player-info { flex: 1; }
        #playerTrack { font-weight: bold; font-size: 15px; }
        #playerArtist { color: #b3b3b3; font-size: 13px; }
        #audio { flex: 1; max-width: 400px; height: 36px; }
        /* Artista page */
        .artista-hero { display: flex; gap: 40px; margin-bottom: 40px; align-items: flex-end; flex-wrap: wrap; }
        .artista-img { width: 220px; height: 220px; object-fit: cover; border-radius: 50%; box-shadow: 0 0 60px rgba(29,185,84,0.3); }
        .artista-info h2 { font-size: 2.8em; margin-bottom: 10px; }
        .back-btn { background: #282828; padding: 10px 20px; border: none; color: white; border-radius: 20px; cursor: pointer; margin-bottom: 30px; font-size: 14px; }
        .back-btn:hover { background: #383838; transform: none; }
        /* Album tracklist */
        .tracklist { background: rgba(40,40,40,0.5); border-radius: 15px; padding: 20px; }
        .track-row { display: flex; align-items: center; gap: 15px; padding: 10px 12px; border-radius: 8px; }
        .track-row:hover { background: rgba(255,255,255,0.07); }
        .track-num { width: 28px; text-align: center; color: #b3b3b3; font-size: 14px; }
        .track-name { flex: 1; font-size: 15px; }
        .track-dur { color: #b3b3b3; font-size: 14px; }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>üéµ Spotify Search</h1>
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="busqueda" placeholder="Buscar canciones, artistas, √°lbumes..." onkeypress="if(event.key==='Enter') buscar()">
                    <select id="tipo">
                        <option value="track">üéµ Canciones</option>
                        <option value="artist">üë§ Artistas</option>
                        <option value="album">üíø √Ålbumes</option>
                        <option value="playlist">üìã Playlists</option>
                    </select>
                    <button onclick="buscar()">Buscar</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="resultados"><div class="loading">üéµ Busca canciones, artistas, √°lbumes o playlists</div></div>
    </div>

    <div id="audioPlayer">
        <div class="player-inner">
            <img id="playerImage" src="" alt="">
            <div class="player-info">
                <div id="playerTrack"></div>
                <div id="playerArtist"></div>
            </div>
            <audio id="audio" controls></audio>
        </div>
    </div>

    <script>
        async function buscar() {
            const resultados = document.getElementById('resultados');
            const busqueda = document.getElementById('busqueda').value.trim();
            const tipo = document.getElementById('tipo').value;
            if (!busqueda) { alert('Por favor ingresa un t√©rmino de b√∫squeda'); return; }
            resultados.innerHTML = '<div class="loading">üîç Buscando en Spotify...</div>';
            try {
                const response = await fetch(`/api/spotify/buscar?q=${encodeURIComponent(busqueda)}&tipo=${tipo}`);
                const data = await response.json();
                if (data.error) { resultados.innerHTML = `<div class="error">‚ùå ${data.error}</div>`; return; }
                if (data.length === 0) { resultados.innerHTML = '<div class="loading">No se encontraron resultados</div>'; return; }
                mostrarResultados(data, tipo);
            } catch (e) {
                resultados.innerHTML = '<div class="error">‚ùå Error al buscar en Spotify</div>';
            }
        }

        function mostrarResultados(datos, tipo) {
            const resultados = document.getElementById('resultados');
            if (tipo === 'track') {
                resultados.innerHTML = `<div class="resultados-grid">${datos.map(t => `
                    <div class="resultado-card">
                        <img src="${t.imagen||''}" class="resultado-imagen" onerror="this.style.background='#333'">
                        <div class="resultado-nombre">${t.nombre}</div>
                        <div class="resultado-info">${t.artista_principal}</div>
                        <div class="resultado-info" style="font-size:12px;">${t.album}</div>
                        <div class="stats">
                            <span class="stat-badge">‚è± ${t.duracion}</span>
                            <span class="stat-badge">üî• ${t.popularidad}%</span>
                            ${t.explicito ? '<span class="stat-badge">üÖ¥</span>' : ''}
                        </div>
                        ${t.preview_url ? `<button class="play-button" onclick="reproducir('${t.preview_url}','${t.nombre.replace(/'/g,"\\'")}','${t.artista_principal.replace(/'/g,"\\'")}','${t.imagen||''}')">‚ñ∂</button>` : '<div style="color:#666;font-size:12px;margin-top:10px;">Sin previa disponible</div>'}
                        <div class="resultado-meta">
                            <a href="${t.spotify_url}" target="_blank" class="spotify-link">Abrir en Spotify ‚Üó</a>
                        </div>
                    </div>`).join('')}</div>`;
            } else if (tipo === 'artist') {
                resultados.innerHTML = `<div class="resultados-grid">${datos.map(a => `
                    <div class="resultado-card" onclick="verArtista('${a.id}')">
                        <img src="${a.imagen||''}" class="resultado-imagen" style="border-radius:50%;" onerror="this.style.background='#333'">
                        <div class="resultado-nombre">${a.nombre}</div>
                        <div class="stats">
                            <span class="stat-badge">üë• ${a.seguidores.toLocaleString()}</span>
                            <span class="stat-badge">üî• ${a.popularidad}%</span>
                        </div>
                        ${a.generos.length>0 ? `<div class="resultado-info" style="margin-top:8px;">${a.generos.slice(0,2).join(', ')}</div>` : ''}
                        <div class="resultado-meta">
                            <a href="${a.spotify_url}" target="_blank" class="spotify-link" onclick="event.stopPropagation()">Spotify ‚Üó</a>
                        </div>
                    </div>`).join('')}</div>`;
            } else if (tipo === 'album') {
                resultados.innerHTML = `<div class="resultados-grid">${datos.map(a => `
                    <div class="resultado-card" onclick="verAlbum('${a.id}')">
                        <img src="${a.imagen||''}" class="resultado-imagen" onerror="this.style.background='#333'">
                        <div class="resultado-nombre">${a.nombre}</div>
                        <div class="resultado-info">${a.artistas.join(', ')}</div>
                        <div class="stats">
                            <span class="stat-badge">üìÖ ${a.fecha_lanzamiento}</span>
                            <span class="stat-badge">üéµ ${a.total_tracks}</span>
                        </div>
                        <div class="resultado-meta">
                            <span style="color:#b3b3b3;text-transform:capitalize;">${a.tipo}</span>
                            <a href="${a.spotify_url}" target="_blank" class="spotify-link" onclick="event.stopPropagation()">Spotify ‚Üó</a>
                        </div>
                    </div>`).join('')}</div>`;
            } else if (tipo === 'playlist') {
                resultados.innerHTML = `<div class="resultados-grid">${datos.map(p => `
                    <div class="resultado-card">
                        <img src="${p.imagen||''}" class="resultado-imagen" onerror="this.style.background='#333'">
                        <div class="resultado-nombre">${p.nombre}</div>
                        <div class="resultado-info">Por ${p.owner}</div>
                        <div class="stats">
                            <span class="stat-badge">üéµ ${p.total_tracks}</span>
                            <span class="stat-badge">${p.publica ? 'üåç P√∫blica' : 'üîí Privada'}</span>
                        </div>
                        <div class="resultado-meta">
                            <a href="${p.spotify_url}" target="_blank" class="spotify-link">Abrir en Spotify ‚Üó</a>
                        </div>
                    </div>`).join('')}</div>`;
            }
        }

        function reproducir(previewUrl, nombre, artista, imagen) {
            const audio = document.getElementById('audio');
            document.getElementById('playerImage').src = imagen;
            document.getElementById('playerTrack').textContent = nombre;
            document.getElementById('playerArtist').textContent = artista;
            audio.src = previewUrl;
            audio.play();
            document.getElementById('audioPlayer').style.display = 'block';
        }

        async function verArtista(artistId) {
            const resultados = document.getElementById('resultados');
            resultados.innerHTML = '<div class="loading">Cargando artista...</div>';
            try {
                const response = await fetch(`/api/spotify/artista/${artistId}`);
                const a = await response.json();
                if (a.error) { resultados.innerHTML = `<div class="error">${a.error}</div>`; return; }
                resultados.innerHTML = `
                    <button class="back-btn" onclick="location.reload()">‚Üê Volver</button>
                    <div class="artista-hero">
                        <img src="${a.imagen||''}" class="artista-img" onerror="this.style.background='#333'">
                        <div class="artista-info">
                            <h2>${a.nombre}</h2>
                            <div class="stats">
                                <span class="stat-badge">üë• ${a.seguidores.toLocaleString()} seguidores</span>
                                <span class="stat-badge">üî• ${a.popularidad}% popularidad</span>
                            </div>
                            ${a.generos.length>0 ? `<div class="stats" style="margin-top:12px;">${a.generos.map(g=>`<span class="stat-badge">${g}</span>`).join('')}</div>` : ''}
                        </div>
                    </div>
                    <h3 style="margin-bottom:20px;color:#1DB954;font-size:1.4em;">üéµ Canciones M√°s Populares</h3>
                    <div class="resultados-grid">
                        ${a.top_canciones.map((t,i) => `
                        <div class="resultado-card">
                            <div style="position:relative;">
                                <img src="${t.imagen||''}" class="resultado-imagen" onerror="this.style.background='#333'">
                                <span style="position:absolute;top:8px;left:8px;background:rgba(0,0,0,0.8);padding:4px 10px;border-radius:12px;font-weight:bold;">#${i+1}</span>
                            </div>
                            <div class="resultado-nombre">${t.nombre}</div>
                            <div class="resultado-info">${t.album}</div>
                            <div class="stats"><span class="stat-badge">‚è± ${t.duracion}</span></div>
                            ${t.preview ? `<button class="play-button" onclick="reproducir('${t.preview}','${t.nombre.replace(/'/g,"\\'")}','${a.nombre}','${t.imagen||''}')">‚ñ∂</button>` : ''}
                        </div>`).join('')}
                    </div>
                    ${a.albums.length>0 ? `
                    <h3 style="margin:40px 0 20px;color:#1DB954;font-size:1.4em;">üíø √Ålbumes</h3>
                    <div class="resultados-grid">
                        ${a.albums.map(al => `
                        <div class="resultado-card" onclick="verAlbum('${al.id}')">
                            <img src="${al.imagen||''}" class="resultado-imagen" onerror="this.style.background='#333'">
                            <div class="resultado-nombre">${al.nombre}</div>
                            <div class="stats"><span class="stat-badge">üìÖ ${al.fecha}</span><span class="stat-badge">üéµ ${al.total_tracks}</span></div>
                        </div>`).join('')}
                    </div>` : ''}`;
            } catch (e) {
                resultados.innerHTML = '<div class="error">Error al cargar artista</div>';
            }
        }

        async function verAlbum(albumId) {
            const resultados = document.getElementById('resultados');
            resultados.innerHTML = '<div class="loading">Cargando √°lbum...</div>';
            try {
                const response = await fetch(`/api/spotify/album/${albumId}`);
                const al = await response.json();
                if (al.error) { resultados.innerHTML = `<div class="error">${al.error}</div>`; return; }
                resultados.innerHTML = `
                    <button class="back-btn" onclick="location.reload()">‚Üê Volver</button>
                    <div class="artista-hero">
                        <img src="${al.imagen||''}" style="width:220px;height:220px;border-radius:12px;object-fit:cover;box-shadow:0 0 50px rgba(29,185,84,0.25);" onerror="this.style.background='#333'">
                        <div class="artista-info">
                            <h2 style="font-size:2.2em;">${al.nombre}</h2>
                            <p style="font-size:17px;color:#b3b3b3;margin-bottom:15px;">${al.artistas.join(', ')}</p>
                            <div class="stats">
                                <span class="stat-badge">üìÖ ${al.fecha_lanzamiento}</span>
                                <span class="stat-badge">üéµ ${al.total_tracks} canciones</span>
                                <span class="stat-badge">üî• ${al.popularidad}%</span>
                            </div>
                            ${al.sello ? `<p style="margin-top:12px;color:#b3b3b3;font-size:13px;">Sello: ${al.sello}</p>` : ''}
                        </div>
                    </div>
                    <h3 style="margin-bottom:15px;color:#1DB954;font-size:1.4em;">Canciones</h3>
                    <div class="tracklist">
                        ${al.tracks.map((t,i) => `
                        <div class="track-row">
                            <span class="track-num">${t.numero}</span>
                            <div class="track-name">${t.nombre}</div>
                            <span class="track-dur">${t.duracion}</span>
                            ${t.preview ? `<button class="play-button" style="width:36px;height:36px;font-size:14px;" onclick="reproducir('${t.preview}','${t.nombre.replace(/'/g,"\\'")}','${al.artistas[0]}','${al.imagen||''}')">‚ñ∂</button>` : ''}
                        </div>`).join('')}
                    </div>`;
            } catch (e) {
                resultados.innerHTML = '<div class="error">Error al cargar √°lbum</div>';
            }
        }
    </script>
</body>
</html>
