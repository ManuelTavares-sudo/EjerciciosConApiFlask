<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0d1117;
            --surface: #161b22;
            --surface2: #21262d;
            --border: #30363d;
            --text: #e6edf3;
            --text-muted: #7d8590;
            --green: #3fb950;
            --blue: #58a6ff;
            --orange: #f0883e;
            --purple: #bc8cff;
            --yellow: #e3b341;
        }
        body {
            font-family: 'Manrope', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* Header */
        .header {
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            background: var(--surface);
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .header-logo {
            font-size: 1.3rem;
            font-weight: 800;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .search-form {
            display: flex;
            gap: 8px;
            flex: 1;
            max-width: 500px;
        }
        .search-form input {
            flex: 1;
            padding: 8px 14px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            transition: border-color 0.2s;
        }
        .search-form input:focus { outline: none; border-color: var(--blue); }
        .btn-search {
            padding: 8px 16px;
            background: var(--green);
            color: #0d1117;
            border: none;
            border-radius: 6px;
            font-family: 'Manrope', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn-search:hover { opacity: 0.85; }

        /* Trending bar */
        .trending-bar {
            padding: 12px 24px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .trending-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
        }
        .lang-filter {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        .lang-btn {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.78rem;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.15s;
        }
        .lang-btn:hover, .lang-btn.active {
            border-color: var(--blue);
            color: var(--blue);
            background: rgba(88,166,255,0.1);
        }

        /* Main */
        .main {
            max-width: 1100px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Profile card */
        .profile-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            animation: fadeIn 0.4s ease;
        }
        .profile-top {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 2px solid var(--border);
        }
        .profile-info { flex: 1; }
        .profile-name {
            font-size: 1.4rem;
            font-weight: 800;
            color: white;
            margin-bottom: 2px;
        }
        .profile-username {
            font-family: 'JetBrains Mono', monospace;
            color: var(--blue);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        .profile-username a { color: inherit; text-decoration: none; }
        .profile-username a:hover { text-decoration: underline; }
        .profile-bio {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .profile-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            font-size: 0.82rem;
            color: var(--text-muted);
        }
        .profile-meta span { display: flex; align-items: center; gap: 4px; }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }
        .stat-box {
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px;
            text-align: center;
        }
        .stat-box .value {
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1;
            margin-bottom: 4px;
        }
        .stat-box .label {
            font-size: 0.72rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        /* Languages */
        .langs-section { margin-top: 20px; }
        .section-title {
            font-size: 0.78rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        .lang-bars {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .lang-bar { display: flex; align-items: center; gap: 10px; }
        .lang-name {
            width: 80px;
            font-size: 0.82rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text);
        }
        .bar-track {
            flex: 1;
            height: 8px;
            background: var(--surface2);
            border-radius: 4px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.6s ease;
        }
        .lang-count {
            width: 30px;
            text-align: right;
            font-size: 0.78rem;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Repos grid */
        .repos-section { margin-bottom: 20px; }
        .repos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
        }
        .repo-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            transition: border-color 0.2s;
            animation: fadeIn 0.4s ease;
        }
        .repo-card:hover { border-color: var(--blue); }
        .repo-name {
            font-family: 'JetBrains Mono', monospace;
            color: var(--blue);
            font-size: 0.9rem;
            font-weight: 600;
            text-decoration: none;
            display: block;
            margin-bottom: 6px;
        }
        .repo-name:hover { text-decoration: underline; }
        .repo-desc {
            color: var(--text-muted);
            font-size: 0.82rem;
            line-height: 1.4;
            margin-bottom: 10px;
        }
        .repo-meta {
            display: flex;
            gap: 12px;
            font-size: 0.78rem;
            color: var(--text-muted);
        }
        .repo-meta span { display: flex; align-items: center; gap: 4px; }
        .lang-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--yellow);
        }

        /* Trending section */
        .trending-section { margin-bottom: 20px; }
        .trending-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
            transition: border-color 0.2s;
            animation: fadeIn 0.3s ease;
        }
        .trending-card:hover { border-color: var(--green); }
        .t-rank {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
            width: 24px;
            text-align: center;
        }
        .t-avatar { width: 32px; height: 32px; border-radius: 50%; }
        .t-info { flex: 1; min-width: 0; }
        .t-name {
            font-family: 'JetBrains Mono', monospace;
            color: var(--blue);
            font-size: 0.88rem;
            font-weight: 600;
            text-decoration: none;
        }
        .t-desc {
            color: var(--text-muted);
            font-size: 0.78rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .t-stars {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--yellow);
            font-size: 0.82rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            white-space: nowrap;
        }

        .loading-state {
            text-align: center;
            padding: 60px;
            color: var(--text-muted);
        }
        .loading-pulse {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--green);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }
        .error-box {
            background: rgba(248,81,73,0.1);
            border: 1px solid rgba(248,81,73,0.3);
            color: #ff7b72;
            border-radius: 8px;
            padding: 14px;
            font-size: 0.9rem;
        }

        .example-users {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            padding: 12px 24px;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
        }
        .example-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 600;
            align-self: center;
        }
        .example-btn {
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 0.78rem;
            font-weight: 700;
            cursor: pointer;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--blue);
            font-family: 'JetBrains Mono', monospace;
            transition: background 0.15s;
        }
        .example-btn:hover { background: rgba(88,166,255,0.1); }

        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        .lang-colors {
            '--JavaScript': '#f1e05a', '--Python': '#3572A5', '--TypeScript': '#2b7489',
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-logo">üêô GitHub Dashboard</div>
        <div class="search-form">
            <input type="text" id="usernameInput" placeholder="Buscar usuario..." onkeydown="if(event.key==='Enter') buscarUsuario()">
            <button class="btn-search" onclick="buscarUsuario()">Buscar</button>
        </div>
    </div>

    <div class="example-users">
        <span class="example-label">Ejemplos:</span>
        <button class="example-btn" onclick="cargarEjemplo('torvalds')">torvalds</button>
        <button class="example-btn" onclick="cargarEjemplo('gaearon')">gaearon</button>
        <button class="example-btn" onclick="cargarEjemplo('sindresorhus')">sindresorhus</button>
        <button class="example-btn" onclick="cargarEjemplo('tj')">tj</button>
        <button class="example-btn" onclick="cargarEjemplo('yyx990803')">yyx990803</button>
    </div>

    <div class="trending-bar">
        <span class="trending-label">üî• Trending:</span>
        <div class="lang-filter">
            <button class="lang-btn active" onclick="loadTrending('')">Todos</button>
            <button class="lang-btn" onclick="loadTrending('Python')">Python</button>
            <button class="lang-btn" onclick="loadTrending('JavaScript')">JavaScript</button>
            <button class="lang-btn" onclick="loadTrending('TypeScript')">TypeScript</button>
            <button class="lang-btn" onclick="loadTrending('Go')">Go</button>
            <button class="lang-btn" onclick="loadTrending('Rust')">Rust</button>
        </div>
    </div>

    <div class="main">
        <div id="userSection" style="display:none"></div>

        <div class="trending-section" id="trendingSection">
            <div class="section-title">Repositorios Trending esta semana</div>
            <div id="trendingList">
                <div class="loading-state">
                    <div class="loading-pulse"></div>
                    <p>Cargando trending...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const langColors = {
            'JavaScript': '#f1e05a', 'Python': '#3572A5', 'TypeScript': '#2b7489',
            'Java': '#b07219', 'Go': '#00ADD8', 'Rust': '#dea584',
            'C++': '#f34b7d', 'C#': '#178600', 'PHP': '#4F5D95',
            'Ruby': '#701516', 'Swift': '#F05138', 'Kotlin': '#A97BFF',
            'Dart': '#00B4AB', 'Shell': '#89e051', 'CSS': '#563d7c'
        };

        function formatNum(n) {
            if (n >= 1000) return (n / 1000).toFixed(1) + 'k';
            return n;
        }

        function cargarEjemplo(user) {
            document.getElementById('usernameInput').value = user;
            buscarUsuario();
        }

        async function buscarUsuario() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) return;
            const section = document.getElementById('userSection');
            section.style.display = 'block';
            section.innerHTML = '<div class="loading-state"><div class="loading-pulse"></div><p>Cargando perfil...</p></div>';

            try {
                const res = await fetch(`/api/github/usuario/${username}`);
                const data = await res.json();
                if (data.error) throw new Error(data.error);

                const maxLang = Math.max(...data.top_lenguajes.map(l => l.repos), 1);

                section.innerHTML = `
                    <div class="profile-card">
                        <div class="profile-top">
                            <img class="avatar" src="${data.avatar}" alt="${data.username}">
                            <div class="profile-info">
                                <div class="profile-name">${data.nombre}</div>
                                <div class="profile-username">
                                    <a href="${data.profile_url}" target="_blank">@${data.username}</a>
                                </div>
                                ${data.bio ? `<div class="profile-bio">${data.bio}</div>` : ''}
                                <div class="profile-meta">
                                    ${data.ubicacion ? `<span>üìç ${data.ubicacion}</span>` : ''}
                                    ${data.empresa ? `<span>üè¢ ${data.empresa}</span>` : ''}
                                    ${data.blog ? `<span>üîó <a href="${data.blog}" target="_blank" style="color:var(--blue)">${data.blog.replace('https://','')}</a></span>` : ''}
                                    <span>üìÖ Desde ${data.creado}</span>
                                </div>
                            </div>
                        </div>
                        <div class="stats-row">
                            <div class="stat-box">
                                <div class="value">${formatNum(data.repositorios)}</div>
                                <div class="label">üì¶ Repos</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">${formatNum(data.seguidores)}</div>
                                <div class="label">üë• Seguidores</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">${formatNum(data.total_stars)}</div>
                                <div class="label">‚≠ê Stars</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">${formatNum(data.total_forks)}</div>
                                <div class="label">üç¥ Forks</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">${formatNum(data.gists)}</div>
                                <div class="label">üìù Gists</div>
                            </div>
                        </div>

                        ${data.top_lenguajes.length > 0 ? `
                        <div class="langs-section">
                            <div class="section-title">Top Lenguajes</div>
                            <div class="lang-bars">
                                ${data.top_lenguajes.map(l => `
                                    <div class="lang-bar">
                                        <div class="lang-name">${l.lenguaje}</div>
                                        <div class="bar-track">
                                            <div class="bar-fill" style="width:${(l.repos/maxLang*100)}%;background:${langColors[l.lenguaje] || '#58a6ff'}"></div>
                                        </div>
                                        <div class="lang-count">${l.repos}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>` : ''}
                    </div>

                    <div class="repos-section">
                        <div class="section-title">‚≠ê Repositorios Destacados</div>
                        <div class="repos-grid">
                            ${data.repos_destacados.map(repo => `
                                <div class="repo-card">
                                    <a class="repo-name" href="${repo.url}" target="_blank">üì¶ ${repo.nombre}</a>
                                    <div class="repo-desc">${repo.descripcion}</div>
                                    <div class="repo-meta">
                                        ${repo.lenguaje ? `<span><span class="lang-dot" style="background:${langColors[repo.lenguaje] || '#58a6ff'}"></span>${repo.lenguaje}</span>` : ''}
                                        <span>‚≠ê ${formatNum(repo.stars)}</span>
                                        <span>üç¥ ${formatNum(repo.forks)}</span>
                                        <span>üìÖ ${repo.actualizado}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } catch (err) {
                section.innerHTML = `<div class="error-box">‚ùå ${err.message}</div>`;
            }
        }

        async function loadTrending(lang) {
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');

            const list = document.getElementById('trendingList');
            list.innerHTML = '<div class="loading-state"><div class="loading-pulse"></div></div>';

            try {
                const res = await fetch(`/api/github/trending?lenguaje=${lang}`);
                const repos = await res.json();
                if (repos.error) throw new Error(repos.error);

                list.innerHTML = repos.map((repo, i) => `
                    <div class="trending-card">
                        <div class="t-rank">${i + 1}</div>
                        <img class="t-avatar" src="${repo.avatar}" alt="">
                        <div class="t-info">
                            <a class="t-name" href="${repo.url}" target="_blank">${repo.nombre}</a>
                            <div class="t-desc">${repo.descripcion}</div>
                        </div>
                        <div class="t-stars">‚≠ê ${formatNum(repo.stars)}</div>
                        ${repo.lenguaje ? `<code style="font-size:0.72rem;color:${langColors[repo.lenguaje]||'#58a6ff'};background:rgba(88,166,255,0.08);padding:2px 6px;border-radius:4px">${repo.lenguaje}</code>` : ''}
                    </div>
                `).join('');
            } catch (err) {
                list.innerHTML = `<div class="error-box">‚ùå ${err.message}</div>`;
            }
        }

        // Load trending on startup
        loadTrending('');
    </script>
</body>
</html>
